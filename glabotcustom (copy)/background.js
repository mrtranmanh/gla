const l={},m="undefined"===typeof browser?chrome:browser,n={};let q={};async function r(b,c,d,e,h){return await (await fetch(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:c,refreshToken:d,playerId:e,i:h})})).json()}
function t(b,c,d,e,h){var k=["https://glad.fociisoftware.com/validate-token","https://fociisoftware.com/validate-token"];u(k[0],b,c,d,e).then(g=>{q[`vt-${b}`]={data:g,h:Date.now()+v()};h({s:!0,d:g})}).catch(()=>{u(k[1],b,c,d,e).then(g=>{q[`vt-${b}`]={data:g,h:Date.now()+v()};h({s:!0,d:g})}).catch(g=>{h({s:!1,m:g.message})})})}function u(b,c,d,e,h){return new Promise((k,g)=>{setTimeout(()=>g(Error("Timeout")),w());r(b,c,d,e,h).then(k).catch(g)})}
function v(){let b=["x","a","5","b"].reduce((c,d)=>c+d.charCodeAt(0),0);return x()*b%y()}function x(){return[10,30,50].reduce((b,c)=>b*c,1)}function y(){let b=[3,0,0,0,0,0].map((c,d)=>c+d);return parseInt(b.join(""),10)}function w(){let b=["b","2","c"].map(c=>c.charCodeAt(0)).join("");return parseInt(b,10)%2E3+1E3}
chrome.runtime.onMessage.addListener((b,c,d)=>{if("vx"===b.action){c=b.data.token;const e=b.data.refreshToken,h=b.data.playerId;b=b.data.i;const k=`vt-${c}`;q[k]&&q[k].h>Date.now()?d({success:!0,data:q[k].data}):t(c,e,h,b,d);return!0}});m.runtime.onMessage.addListener((b,c,d)=>{const e=c.tab.id;b.j&&b.g&&m.tabs.sendMessage(c.o.id,{j:!0,g:b.g});b.keepAlive?(l[e]=Date.now(),d({success:!0})):b.queryButtonClickedState?d({state:n[e]||!1}):b.l&&(n[e]=!0)});
setInterval(function(){const b=Date.now();for(let c in l)5E3<b-l[c]&&(l[c]=b,n[c]||(n[c]=!1))},1E4);m.tabs.onRemoved.addListener(b=>{l[b]&&delete l[b];n[b]&&delete n[b]});
